#!/bin/bash

source GoboPath

cmd="$1"
[ "$cmd" ] || cmd=Start

case "$cmd" in

[Ss]tart)

   mount -t devtmpfs udev "$goboDevices"
   cp -a -f "$goboLibraries"/udev/devices/* "$goboDevices"
   mount -t devpts devpts "$goboDevices/pts"

   # udevd listens for hotplug events through netlink
   $goboPrograms/Udev/Current/lib/udev/udevd --daemon
   echo "" > "$goboStatus/sys/kernel/hotplug"

   # wait for events to finish
   udevadm trigger --action=add
   udevadm settle --timeout=10

   ;;
   
[Ss]top)

   killall udevd

   ;;
   
[Rr]estart)

   cp -a -f "$goboLibraries"/udev/devices/* "$goboDevices"
   udevadm trigger
   udevadm settle --timeout=10

   ;;

esac
